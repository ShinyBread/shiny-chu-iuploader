{% extends 'base.html' %}
{% load static %}

{% block title %}Shinychu - VCR Mode{% endblock %}

{% block extra_css %}
<style>

    :root {
        --blue: #000000;
        --green: #1eff00;
    }

    /* --- EFECTOS CRT (Scanlines, Ruido, Vignette) --- */
    .vignette::before {
        content: ''; position: absolute; inset: 0;
        background: radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.4) 100%);
        z-index: 500; mix-blend-mode: overlay; pointer-events: none;
    }

    .noise {
        position: fixed; inset: 0; z-index: 400; opacity: 0.05; pointer-events: none;
        background: url('https://ice-creme.de/images/background-noise.png');
    }
    .noise-moving {
        opacity: 0.08; z-index: 450; animation: noise 1s infinite alternate;
    }
    .scanlines {
        position: fixed; inset: 0; pointer-events: none; z-index: 300; opacity: 0.6;
        background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.5) 51%);
        background-size: 100% 4px; animation: scanlines 0.2s linear infinite;
    }

    /* Animaciones Keyframes */
    @keyframes noise { 0%, 100% { background-position: 0 0; } 10% { background-position: -5% -10%; } 20% { background-position: -15% 5%; } 30% { background-position: 7% -25%; } 40% { background-position: 20% 25%; } 50% { background-position: -25% 10%; } 60% { background-position: 15% 5%; } 70% { background-position: 0 15%; } 80% { background-position: 25% 35%; } 90% { background-position: -10% 10%; } }
    @keyframes scanlines { from { background-position: 0 0; } to { background-position: 0 4px; } }
    @keyframes rgbText {
        0% { text-shadow: -2px 2px 0 red, 2px -2px 0 blue; }
        25% { text-shadow: 2px 2px 0 red, -2px -2px 0 blue; }
        50% { text-shadow: -2px -2px 0 red, 2px 2px 0 blue; }
        75% { text-shadow: 2px -2px 0 red, -2px 2px 0 blue; }
        100% { text-shadow: -2px 2px 0 red, 2px -2px 0 blue; }
    }
    @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }


    .hud-anim { animation: rgbText 2s steps(9) infinite alternate; }
    .retro-shadow-box { box-shadow: 10px 10px 0px var(--blue); }
    .retro-text-shadow { text-shadow: 2px 2px 0px var(--blue); }
    .uploading { background: var(--green) !important; color: black !important; animation: blink 0.5s infinite; }
    
    /* Estilo del input file nativo */
    input[type="file"] { font-family: 'Press Start 2P', cursive; font-size: 0.7rem; color: white; width: 100%; }
</style>
{% endblock %}

{% block content %}
    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div class="noise"></div>
    <div class="noise noise-moving"></div>

    <div class="relative w-screen h-screen bg-[#270245] text-white flex flex-col justify-center items-center overflow-hidden">
        
        <div class="absolute top-8 left-8 text-2xl hud-anim pointer-events-none z-50">PLAY ►</div>
        <div class="absolute top-8 right-8 text-2xl hud-anim pointer-events-none z-50" id="clock">00:00:00</div>
        <div class="absolute bottom-8 left-8 text-2xl hud-anim pointer-events-none z-50 text-red-500">REC ●</div>

        <div class="relative z-[600] border-4 border-white bg-black/80 p-8 text-center max-w-[500px] w-[90%] retro-shadow-box">
            
            <h1 class="text-2xl mb-8 leading-normal text-[#02ff00] retro-text-shadow">
                UPLOAD YOUR IMAGE!
            </h1>

            {% if url_resultado %}
                <div class="border-2 border-[#00ff00] p-4 mb-4 bg-[#002200]">
                    <p class="text-[#00ff00] text-xs mb-4">UPLOAD COMPLETE!</p>
                    
                    <input type="text" value="{{ url_resultado }}" readonly 
                           class="bg-transparent border-none text-[#00ff00] text-xs w-full mb-4 text-center focus:outline-none font-['Press_Start_2P']" 
                           id="shareUrl">
                    
                    <button onclick="copyToClipboard(this)" 
                            class="bg-[#2b52ff] text-white border-4 border-white py-4 px-8 text-xs cursor-pointer uppercase transition-transform hover:bg-[#fd5d8d] hover:translate-x-0.5 hover:translate-y-0.5 active:translate-x-1 active:translate-y-1 w-full font-['Press_Start_2P']">
                        COPY LINK
                    </button>
                </div>

                <a href="/" class="text-white text-[0.7rem] block mt-4 no-underline hover:text-[#fd5d8d]">
                    [ UPLOAD ANOTHER ]
                </a>

            {% else %}
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="mb-8 border-2 border-dashed border-white p-4 cursor-pointer hover:bg-white/10 transition-colors">
                        {{ form.image }}
                    </div>

                    <button type="submit" class="bg-[#2b52ff] text-white border-4 border-white py-4 px-8 text-base cursor-pointer uppercase transition-transform hover:bg-[#fd5d8d] hover:translate-x-0.5 hover:translate-y-0.5 active:translate-x-1 active:translate-y-1 w-full font-['Press_Start_2P']" id="uploadBtn">
                        START UPLOAD
                    </button>
                </form>
                
                <p class="text-[0.6rem] text-gray-400 mt-4 uppercase">PRESS CTRL+V TO PASTE</p>
            {% endif %}
        </div>

    </div>
{% endblock %}

{% block scripts %}
<script>
    // --- RELOJ EN TIEMPO REAL ---
    function updateTime() {
        const now = new Date();
        // Formato HH:MM:SS
        const timeString = now.toLocaleTimeString('en-US', { 
            hour12: false, 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit' 
        });
        document.getElementById('clock').innerText = timeString;
    }
    // Actualizar cada segundo
    setInterval(updateTime, 1000);
    updateTime(); // Llamada inicial para no esperar 1 segundo

    // --- Lógica de Copiar ---
    function copyToClipboard(btn) {
        var copyText = document.getElementById("shareUrl");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value);

        let originalText = btn.innerText;
        btn.innerText = "COPIED!";
        btn.style.background = "#00ff00"; // Verde retro
        btn.style.color = "black";

        setTimeout(() => {
            btn.innerText = originalText;
            btn.style.background = ""; 
            btn.style.color = "";
        }, 2000);
    }

    // --- Lógica de Pegar (Ctrl+V) ---
    document.addEventListener('paste', function(event) {
        const items = (event.clipboardData || event.originalEvent.clipboardData).items;

        for (const item of items) {
            if (item.kind === 'file' && item.type.startsWith('image/')) {
                const file = item.getAsFile();
                const fileInput = document.querySelector('input[type="file"]');
                const form = document.querySelector('form');
                
                if (!fileInput || !form) return;

                const submitBtn = document.getElementById('uploadBtn');

                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;

                submitBtn.innerText = "PROCESSING...";
                submitBtn.classList.add('uploading');

                form.submit();
                event.preventDefault();
                break;
            }
        }
    });
</script>
{% endblock %}